---
layout: post
title: "Part 4: Making the Most of Async in Node.js"
topics: [ Async, Concurrency, Development, Performance ]
published: false
---

In [Part 3](/2025/12/04/part3.html) we discussed heterogeniety and some other tuning tricks. Now
it's time for some of the rest of the story.

## The Mopping Up

None of the concepts I've discussed so far are a magic wand to deal with the limitations of the 
single threaded model in Node.js. Task switching is more administrative overhead, as it is in
any programming language. You only get more work done when you have tasks alternating between
being IO bound and CPU bound, and the factor is ofter relatively small, on the order of 2x. 
So take some care with your chunk sizes, in both directions.

### Arrange

In Node.js 24, awaiting a function is still about 90x slower than a synchronous function return,
even when the function called is itself synchronous. This is down from > 100x in previous versions
of v8. 

### Routinely Confirm Your Tuning Parameters

If a job you are running can finish in the same time using 10 parallel requests or 20 parallel
requests, it is a better neighbor if it is configured for 10 tasks instead of 20. That's less 
jitter for all of your peers, and it costs you very little. 

However, every time that service gets upgraded or the cluster size changed, that optimal number
can go up or it can go down. So it is important to document your findings for how changing the 
settings by Â±50% should affect runtime, and occasionally run that experiment again to see if the
numbers still hold. Maybe increasing it used to only speed up your job by 5% and trigger more
alerts. Maybe now it has no effect, or doesn't trigger any alerts.

## Conclusions

Special thanks to [Sindre Sorhus](https://github.com/sindresorhus), an open source author who 
demonstrates Single Responsibility Principle in his Node.js modules with a consistency I have rarely
seen in the wild. Please check out his work, particularly [p-limit](https://github.com/sindresorhus/p-limit)
and [p-retry](https://github.com/sindresorhus/p-retry).
